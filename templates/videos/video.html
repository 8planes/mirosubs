{% extends "base.html" %}
{% block body_attrs %}id="video"{% endblock %}

{% load escapejs widget comments recent_activity paginator i18n %}

{% block css %}
    {{ block.super }}
    <link href="{{ MEDIA_URL }}css/mirosubs-widget.css" media="all" type="text/css" rel="stylesheet" />
    <style>
        div.mirosubs-widget {
            position: relative;
        }
        
        .mirosubs-videoDiv {
            text-align: center;
        }
        
        .mirosubs-widget video, .mirosubs-widget object, .mirosubs-widget embed {
            width: 480px;
        }
        
        #embed {
            white-space: pre;
            background: #eee;
            border: #666;
        }
    </style>

    <link href="{{ MEDIA_URL }}css/nyroModal.css" media="all" type="text/css" rel="stylesheet" />
    <style>
        .error_list {
            color: #fa6343;
        }
        
        .success-message {
            color: #5ae26b;
            margin: 5px 0 0;
        }
    </style>
{% endblock %}

{% block scripts %}
    {% include "widget/_js_onsite_dependencies.html" %}
    {{ block.super }}
    <script type="text/javascript">
        jQuery(document).ready(function($){
            //******** Tabs ********//
            var $last_active_tab = $($('.inline_tabs li.active a').attr('href'));
            $('.inline_tabs a, a.link_to_tab').click(function(){
                var href = $(this).attr('href')
                $last_active_tab.hide();
                $last_active_tab = $(href).show();
                $('.inline_tabs li').removeClass('active');
                $('.inline_tabs a[href='+href+']').parent('li').addClass('active');
                document.location.hash = href.split('-')[0];
                return false;
            });
                        
            if (document.location.hash){
                var tab_name = document.location.hash.split('-', 1)
                if (tab_name){
                    $('a[href='+tab_name+'-tab]').click();
                    document.location.href = document.location.href;
                }
            }

            $('#add_subtitles').click(function() {
                widget_widget_div.selectMenuItem(
                    mirosubs.widget.DropDown.Selection.IMPROVE_SUBTITLES);
                return false;
            });

            $('#add_translation').click(function() {
                widget_widget_div.selectMenuItem(
                    mirosubs.widget.DropDown.Selection.ADD_TRANSLATION);
                return false;
            });
            
            var CHANGE_TITLE_LINK = '{% url videos:ajax_change_video_title %}';
            var VIDEO_ID = '{{ video.video_id }}';
            
            $('.edit-title').click(function(){
                var title = prompt('{% trans "Enter new title" %}', $('.main-title').html());
                if (title){
                    $('.main-title').html(title);
                    $.post(CHANGE_TITLE_LINK, {
                        video_id: VIDEO_ID,
                        title: title
                    });
                }
                return false;
            });
        });
    </script>  
    <script src="{{ MEDIA_URL }}js/jquery.nyroModal-1.6.2.pack.js" type="text/javascript"></script>
{% endblock %}

{% block title %}
    {{ video.title_display }} | Universal Subtitles
{% endblock %}

{% block main_content %}

    <h2 class="main-title">{{ video.title_display }}</h2>

    {% if not video.title or video.is_html5 %}
        <a href="#" class="edit-title">{% trans 'edit title' %}</a>   
    {% endif %}

    {% if saved %}
        <h2>{% blocktrans %}Subtitles saved!  You can share the video with friends, 
          or get an embed code for your site.  To add a
          translation, click the button below.{% endblocktrans %}</h2>
    {% endif %}

    <div class="grid_6 alpha left_column">
        {% widget widget_params %}
    </div>
    
    <div class="grid_6 omega right_column">
        {% include '_sharing_widget.html' %}
    </div>

    <hr />

  <div class="grid_3 left_nav_wrapper alpha">
    <ul class="left_nav">
        <li class="active"><a href="{{ video.get_absolute_url }}">{% trans 'Video Info' %}</a></li>
        {% if video.subtitle_language %}
            <li {% if language.is_original %}class="active"{% endif %}><a href="{{ video.subtitle_language.get_absolute_url }}">{% trans 'Original' %}</a></li>
        {% endif %}
        {% if translations %} 
          {% for item in translations %}  
             <li {% if language == item %}class="active"{% endif %}><a href="{{ item.get_absolute_url }}">{{ item.get_language_display }}</a></li>
          {% endfor %} 
        {% endif %}
    </ul>
    {% if video.latest_finished_version %}
    <a class="green_button small" id="add_translation" href="#">{% trans 'Add Translation' %}</a>
    {% endif %}   
  </div>

  <div class="wrap grid_9 omega">  
      <h4 class="inline">{% trans 'Video Info' %}</h4>      

      <ul class="inline_tabs">
        <li class="active"><a href="#comments-tab">{% trans 'Comments' %} <span class="badgy_out"><span class="badgy">{{ lang_count }}</span></span></a></li>
        <li class="bull">&bull;</li>
        {% comment %}
        <li><a href="#comments-tab">{% trans 'Video URLS' %} <span class="badgy_out"><span class="badgy">{% get_comment_count video %}</span></span></a></li>
        <li class="bull">&bull;</li>
        {% endcomment %}
        <li><a href="#activity-tab">{% trans 'Activity Stream' %}</a></li>
      </ul>

      <div class="action_buttons grid_9 alpha omega">
          {% with translations|length as has_translations %}
              {% include 'videos/_upload_subtitles.html' %}
          {% endwith %}       
      </div>
      
      <div id="comments-tab">
          <div class="grid_9 alpha omega">
            {% render_comment_form video %}
            {% render_comment_list video %}
            <div style="clear: both"></div>        
          </div>
      </div>
      
      <div id="activity-tab" style="display: none">
          <div class="grid_9 alpha omega">
          {% video_activity video %}
          </div>
      </div>
  </div>  

{% endblock %}
