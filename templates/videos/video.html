{% extends "base.html" %}

{% load escapejs widget comments recent_activity paginator %}

{% block css %}
    {{ block.super }}
    <link href="{{ MEDIA_URL }}css/mirosubs-widget.css" media="all" type="text/css" rel="stylesheet" />
    <style>
        div.mirosubs-widget {
            position: relative;
        }
        
        .mirosubs-videoDiv {
            text-align: center;
        }
        
        .mirosubs-widget video, .mirosubs-widget object, .mirosubs-widget embed {
            width: 480px;
        }
        
        #embed {
            white-space: pre;
            background: #eee;
            border: #666;
        }
    </style>
{% endblock %}

{% block scripts %}
    {% include "widget/_js_onsite_dependencies.html" %}
    {{ block.super }}
    <script type="text/javascript">
        jQuery(document).ready(function($){
            //******** Tabs ********//
            var $last_active_tab = $($('.video_tabs li.active a').attr('href'));
            $('.video_tabs a').click(function(){
                var href = $(this).attr('href')
                $last_active_tab.hide();
                $last_active_tab = $(href).show();
                $('.video_tabs li').removeClass('active');
                $(this).parent('li').addClass('active');
                document.location.hash = href.split('-')[0];
                return false;
            });
            
            if (document.location.hash){
                var tab_name = document.location.hash.split('-', 1)
                if (tab_name){
                    $('a[href='+tab_name+'-tab]').click();
                    document.location.href = document.location.href;
                }
            }

            $('#add_subtitles').click(function() {
                widget_widget_div.selectMenuItem(
                    mirosubs.MainMenu.Selection.ADD_SUBTITLES);
                return false;
            });

            $('#add_translation').click(function() {
                widget_widget_div.selectMenuItem(
                    mirosubs.MainMenu.Selection.ADD_NEW_LANGUAGE);
                return false;
            });
        });
    </script>   
{% endblock %}

{% block title %}
    {{ video.title_display }} | Universal Subtitles
{% endblock %}

{% block main_content %}
    <div class="left_column">
        {% if video.title %}
            <h2>{{ video.title }}</h2>
        {% endif %}
        {% widget widget_params %}
    </div>
    
    <div class="right_column">
        {% include '_testing_widget.html' %}
        {% if not video.captions %}
        <a class="button" id="add_subtitles" href="#"><span>Add Subtitles</span></a>
        {% else %}
        <a class="button" id="add_translation" href="#"><span>Add Translation</span></a>
        {% endif %}
    </div>
    <div class="clearboth">&nbsp;</div>
    
    <ul class="video_tabs">
      <li class="active"><a href="#languages-tab">Languages ({{ translations|length }})</a></li>
      <li><a href="#comments-tab">Comments ({% get_comment_count video %})</a></li>
      <li><a href="#activity-tab">Activity stream</a></li>
    </ul>

    {% with translations|length as has_translations %}
        {% include 'videos/_upload_subtitles.html' %}
    {% endwith %}
    
    <div id="languages-tab" class="tab">
        {% if translations or video.captions %} 
            <ul class="table_head">
              <li class="grid_6">Language</li>
              <li class="grid_2">Rating</li>
              <li class="grid_4 grid_last">% Done</li>
            </ul>
    
            <ul class="table_body">
                <li class="table_row">

                    <span class="grid_6">
                        <a href="{% url videos:history video.video_id %}">
                            Original
                        </a>
                    </span>
                    <span class="grid_2">A+</span>
                    <span class="grid_4 grid_last" style="text-align: center;">
                        n/a
                    </span>

                </li>                
                {% for item in translations %}
                    <li>
                        <span class="grid_6">
                            <a href="{% url videos:translation_history video.video_id item.language %}">
                                {{ item.get_language_display }}
                            </a>
                        </span>
                        <span class="grid_2">A+</span>
                        <span class="grid_4 grid_last">
                            <span class="progress">
                                <span class="completion {% progress_color item.percent_done %}" style="width: {{ item.percent_done }}%"></span>
                            </span>
                        </span>
                    </li>
                {% endfor %}            
            </ul>
        {% else %}
            <p class="no_subs">This video has no subtitles yet.  Make some!</p>
        {% endif %}
        <div style="clear: both"></div>
    </div>
    
    <div style="display: none" id="comments-tab" class="tab">
       {% render_comment_form video %}
       {% render_comment_list video %}
       <div style="clear: both"></div>        
    </div>
    
    <div style="display: none" id="activity-tab" class="tab">
        {% video_activity video %}
    </div>    
{% endblock %}
