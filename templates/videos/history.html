{% extends "base.html" %}

{% load escapejs paginator %}

{% block css %}
  {{ block.super }}
  <link href="{{ MEDIA_URL }}css/mirosubs-widget.css" media="all" type="text/css" rel="stylesheet" />
  <style>
    div.mirosubs-widget {
        position: relative;    
    }
    .mirosubs-videoDiv {
        text-align: center;
    }
    .mirosubs-videoDiv video, .mirosubs-videoDiv object, .mirosubs-videoDiv embed{
    width: 460px;
    }
    
    #embed{
      white-space: pre;
      background: #eee;
      boder: #666;
    }
  </style>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    {% if not js_use_compiled %}
      <script type="text/javascript" src="{{ MEDIA_URL }}js/closure-library/closure/goog/base.js"></script>
      <script type="text/javascript" src="{{ MEDIA_URL }}js/closure-dependencies.js"></script>
      <script type="text/javascript" src="{{ MEDIA_URL }}js/swfobject.js"></script>
    {% endif %}
    {% for dep in js_dependencies %}
      <script type="text/javascript" src="{{dep|safe}}"></script>
    {% endfor %}
    <script type="text/javascript">
        //create url template
        var DIFFING_URL = function(){
            var url = '{% block diffing_link %}{% url videos:diffing 11111 22222 %}{% endblock %}';
            return url.replace(/11111/, '<<first_pk>>').replace(/22222/, '<<second_pk>>');
        }();
        
        function get_compare_link(first_pk, second_pk){
            //set values from arguents
            return DIFFING_URL.replace(/<<first_pk>>/, first_pk).replace(/<<second_pk>>/, second_pk);
        }

            jQuery(document).ready(function($){
                $('.compare_versions_button').click(function(){
                    var $checked = $('.version_checkbox:checked');
                    if ($checked.length !== 2){
                        alert('Select two revisions for compare, please');
                    }else{
                        var url = get_compare_link($checked[0].value, $checked[1].value);
                        window.location.replace(url);
                    }
                });
            });
    </script>
{% endblock %}

{% block main_content %}
    <h2>{{ video }}</h2>
    <p class="what_lang">
        {% block lang_display %}
            in <a href="{% url videos:video video_id=video.video_id %}">Original Language</a>
        {% endblock %}
    </p>
    
    <div class="left_column">
        {% with video.video_url as video_url %}
            {% include "widget/widget.html" %}
            <script type="text/javascript">
                mirosubs.EmbeddableWidget.wrap({% include "widget/embed_params.js" %});
            </script>
        {% endwith %}
    </div>
    
    <div class="right_column">
        {% block translation_list %}
            {% if translations %}
                <p class="other_lang">
                    Other Languages:
                        {% for item in translations %}
                            <a href="{% url videos:translation_history video.video_id item.language %}">{{ item.get_language_display }}</a>{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                 </p>             
            {% endif %}
        {% endblock %}
    </div>
    
    <div class="clear">&nbsp;</div>
    
    <h2>Recent Revisions <a class="whats_this" href="#">(What's This?)</a></h2>
    
    <button class="compare_versions_button"><span>Compare Revisions</span></button>
    
    <ul class="table_head">
      <li class="table_most_recent">{% ordered_column "date" "Most Recent" %}</li>
      <li class="table_user">{% ordered_column "user" "User" %}</li>
      <li class="table_note">{% ordered_column "note" "Note" %}</li>
      <li class="table_time">{% ordered_column "time" "Time" %}</li>
      <li class="table_text">{% ordered_column "text" "Text" %}</li>
    </ul>
    
   
   <ul class="table_body"> 
    {% for item in revisions %}
          <li>
            <ul>
              <li class="table_most_recent"><input type="checkbox" class="version_checkbox" value="{{ item.pk }}"/> {{ item.revision_time }}</li>
              <li class="table_user">
                  <a href="{% url profiles:profile item.user.pk %}">{{ item.user.username }}</a>
              </li>
              <li class="table_note">{% if item.note %}{{ item.note }}{% else %}&nbsp;{% endif %}</li>
              <li class="table_time">{{ item.time_change }}</li>
              <li class="table_text">{{ item.text_change }}</li>
              <li>
                  {% block view_link %}
                    <a href="{% url videos:revision pk=item.pk %}">view</a>
                  {% endblock %}
              </li>
            </ul>
          </li>    
    {% endfor %}
   </ul> 
    
{% endblock %}