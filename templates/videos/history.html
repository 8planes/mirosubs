{% extends "base.html" %}

{% load escapejs paginator widget comments %}

{% block css %}
    {{ block.super }}
    <link href="{{ MEDIA_URL }}css/mirosubs-widget.css" media="all" type="text/css" rel="stylesheet" />

    <style>
        div.mirosubs-widget {
            position: relative;
        }
        
        .mirosubs-videoDiv {
            text-align: center;
        }
        
        .mirosubs-videoDiv video {
            width: 460px;
        }
        
        #embed {
            white-space: pre;
            background: #eee;
            boder: #666;
        }
    </style>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    {% include "widget/_js_onsite_dependencies.html" %}
    <script type="text/javascript">
        //create url template
        var DIFFING_URL = function(){
            var url = '{% block diffing_link %}{% url videos:diffing 11111 22222 %}{% endblock %}';
            return url.replace(/11111/, '<<first_pk>>').replace(/22222/, '<<second_pk>>');
        }();
        
        function get_compare_link(first_pk, second_pk){
            //set values from arguents
            return DIFFING_URL.replace(/<<first_pk>>/, first_pk).replace(/<<second_pk>>/, second_pk);
        }
        
        jQuery(document).ready(function($){
            $('.version_checkbox:first').attr('checked', 'checked');
            
            $('.version_checkbox').change(function(){
                var $this = $(this);
                var checked_length = $('.version_checkbox:checked').length;
                
                if ($this.attr('checked') && (checked_length > 2)) {
                    $this.attr('checked', '');
                }
            });
            
            $('.compare_versions_button').click(function(){
                var $checked = $('.version_checkbox:checked');
                if ($checked.length !== 2) {
                    alert('Select two revisions for compare, please');
                }
                else {
                    var url = get_compare_link($checked[0].value, $checked[1].value);
                    window.location.replace(url);
                }
            });
            //******** Tabs ********//
            var $last_active_tab = $($('.video_tabs li.active a').attr('href'));
            $('.video_tabs a').click(function(){
                $last_active_tab.hide();
                $last_active_tab = $($(this).attr('href')).show();
                $('.video_tabs li').removeClass('active');
                $(this).parent('li').addClass('active');
                return false;
            });
                        
            if (document.location.hash){
                var tab_name = document.location.hash.split('-', 1)
                if (tab_name){
                    $('a[href='+tab_name+']').click();
                    document.location.href = document.location.href;
                }
            }
        });
    </script>
{% endblock %}

{% block main_content %}
    <h2><a href="{% url videos:video video_id=video.video_id %}">{{ video }}</a></h2>
    <p class="what_lang">
        {% block lang_display %} 
            in Original Language
        {% endblock %}
        {% block translation_list %}
            {% if translations %}
                <p class="other_lang">
                    Other Languages:
                        {% for item in translations %}
                            <a href="{% url videos:translation_history video.video_id item.language %}">{{ item.get_language_display }}</a>{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                 </p>
            {% endif %}
        {% endblock %}        
    </p>
    <div class="left_column">
        {% widget widget_params %}
    </div>
    <div class="right_column"></div>
    
    <div class="clearboth">&nbsp;</div>

    <ul class="video_tabs">
      <li class="active">
          <a href="#trascripts">
            {% block trascripts_tab %}Original Language Subtitles{% endblock %}
          </a>
      </li>
      <li><a href="#comments">Comments ({% get_comment_count commented_object %})</a></li>
      <li><a href="#revisions">History ({{ hits }})</a></li>
    </ul>
    
    {% with translations|length as has_translations %}
        {% include 'videos/_upload_subtitles.html' %}
    {% endwith %}
    
    <div style="display: none" id="revisions" class="tab">
        {% if revision_list|length > 1 %}
            <button class="compare_versions_button">
                <span>Compare Revisions</span>
            </button>
        {% endif %}
        
        {% if revision_list %}
           {% if is_paginated %}{% ordered_paginator 3 '#revisions' %}{% endif %} 

           {% block table %}
            <ul class="table_head">
                <li class="grid_4">
                    {% ordered_column "date" "Most Recent" #revisions %}
                </li>
                <li class="grid_4">
                    {% ordered_column "user" "User" #revisions %}
                </li>
                <li class="grid_2">
                    {% ordered_column "note" "Note" #revisions %}
                </li>
                <li class="grid_1">
                    {% ordered_column "time" "Time" #revisions %}
                </li>
                <li class="grid_1 grid_last">
                    {% ordered_column "text" "Text" #revisions %}
                </li>
            </ul>
            
            <ul class="table_body">
                {% for item in revision_list %}
                <li {% cycle 'class="even"' '' %}>

                        <span class="grid_4">
                            <input type="checkbox" class="version_checkbox" value="{{ item.pk }}"/><a href="{% url videos:revision pk=item.pk %}">#{{ item.version_no}}</a> ({{ item.revision_time }})
                        </span>
                        <span class="grid_4">
                            <a href="{% url profiles:profile item.user.pk %}">{{ item.user.username }}</a>
                        </span>
                        <span class="grid_2">
                            {% if item.note %}{{ item.note }}{% else %}&nbsp;{% endif %}
                        </span>
                        <span class="grid_1">
                            {{ item.time_change_display }}
                        </span>
                        <span class="grid_1 grid_last">
                            {{ item.text_change_display }}
                        </span>

                </li>
                {% endfor %}
            </ul>
            
            <div style="clear: both"></div>
           {% endblock %}
       {% else %}
            <div class="nothing">
                <strong>This revision has no subtitles</strong><br />
                Either no subtitles have been entered, or they were deleted.
            </div>
       {% endif %}
   </div>
   
   <div style="display: none" id="comments" class="tab">
       {% render_comment_form commented_object %}

  <ul class="table_body container_12 comments">
    
        
    <li class="table_comment" comment_id="6">
        <div class="table_user_deets">
            <span class="user_thumb"><img src="" /></span>

            <a href="/profiles/3/">morganknutson</a>
            <span class="comment_date">1 week, 5 days ago</span>
        </div>
        <div class="comment_text">

          <div class="replied">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>

            <a name="comments-6"></a>
            
                <a href="#comments-5">replied to comment from morganknutson</a>
            
            <a href="#" class="floatright reply"  comment_id="6">

                <span>Reply</span>
            </a>
            <p>sdfsdfdsfsdf</p>
        </div>
    </li>
    
        
    <li class="table_comment table_rated" comment_id="5">
    
      Gave this translation a B+

    </li>

    <li class="table_comment" comment_id="5">
        

        <div class="table_user_deets">
            <span class="user_thumb"><img src="" /></span>

            <a href="/profiles/3/">morganknutson</a>
            <span class="comment_date">1 week, 5 days ago</span>
        </div>
        <div class="comment_text">
        <div class="table_rated">Gave this translation a B+</div>

            <a name="comments-5"></a>
            
                <a href="#comments-3">replied to comment from morganknutson</a>
            
            <a href="#" class="floatright reply"  comment_id="5">

                <span>Reply</span>
            </a>
            <p>sdfsdfsdf</p>
        </div>
    </li>
    
        
    <li class="table_comment" comment_id="4">
        <div class="table_user_deets">
            <span class="user_thumb"><img src="" /></span>

            <a href="/profiles/3/">morganknutson</a>
            <span class="comment_date">1 week, 5 days ago</span>
        </div>
        <div class="comment_text">
            <a name="comments-4"></a>
            
                <a href="#comments-2">replied to comment from morganknutson</a>
            
            <a href="#" class="floatright reply"  comment_id="4">

                <span>Reply</span>
            </a>
            <p>sdfsdfsdfsdf</p>
        </div>
    </li>
    
    
</ul>


       {% render_comment_list commented_object %}
       <div style="clear: both"></div>     
   </div>
   
   <div id="trascripts" class="tab">
        <ul class="table_body"> 
            {% for item in last_version.captions %}
                <li class="table_transcript {% cycle 'even' '' %}">
                    {{ item.display_time }} - {{ item.display_end_time }} &gt; {{ item.text }}
                </li>
            {% endfor %}
        </ul>
       <div style="clear: both"></div>   
   </div>
{% endblock %}

