{% extends "base.html" %}

{% load widget %}

{% block css %}
  {{ block.super }}
  <link href="{{ MEDIA_URL }}css/mirosubs-widget.css" media="all" type="text/css" rel="stylesheet" />
  <style>
    div.mirosubs-widget {
        position: relative;    
    }
    .mirosubs-videoDiv {
        text-align: center;
    }
    .mirosubs-videoDiv video, .mirosubs-videoDiv object, .mirosubs-videoDiv embed{
    width: 460px;
    }
    
    #embed{
      white-space: pre;
      background: #eee;
      boder: #666;
    }
  </style>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script type="text/javascript">
        $(function(){
            var IS_AUTHENTICATED = '{{ user.is_authenticated }}' == 'True';
            if (IS_AUTHENTICATED){
                $('.roll_back').click(function(){
                    if ( ! confirm('Do roll back to this version?')){
                        return false;
                    }                    
                });                
            }else{
                $('.roll_back, .new_edit').click(function(){
                    alert('You need to log in to do that.');
                    return false;
                });
            }
        });
    </script>
    {% include "widget/_js_onsite_dependencies.html" %}
{% endblock %}

{% block main_content %}
    <h2>Revision #{{ version.version_no }} - {{ version.revision_time }}</h2>
    {{ video }} in language {{ version.language_display }} language<br/><br/>
        
    {% if next_version %}
        <div class="viewing_old">
            This is an old revision of {% if version.language %}{{ version.language.get_language_display }}
            {% else %}original{% endif %} language subtitles for "{{ video }}", 
            as edited by {{ version.user.username }} at {{ version.datetime_started|date:"H:i, j F Y" }}. It may
            differ significantly from the current revision.
        </div>
    {% endif %}
    
    {% block navigation %}
        <ul class="pag" style="width: 420px">
            
          {% if prev_version %}
              <li class="previous">
                {% ifnotequal latest_version prev_version %}
                    (<a href="{% url videos:diffing latest_version.pk prev_version.pk %}">diff</a>) 
                {% endifnotequal %}
                &#8592; 
                <a href="{% url videos:revision pk=prev_version.pk %}">
                    Previous Revision
                </a>
              </li>
          {% endif %}
          
          {% if next_version %}
              <li class="next">
                <a href="{% url videos:revision pk=next_version.pk %}">
                    Next Revision
                </a> &#8594;
                {% ifnotequal latest_version next_version %}
                    (<a href="{% url videos:diffing latest_version.pk next_version.pk %}">diff</a>) 
                {% endifnotequal %}                
              </li>
          {% endif %}
          
          <li class="current">
            <a href="{% url videos:revision pk=latest_version.pk %}">
                The most recent revision
            </a>
            {% ifnotequal latest_version version %}
                (<a href="{% url videos:diffing latest_version.pk version.pk %}">diff</a>) 
            {% endifnotequal %}               
          </li>
          
        </ul>
    {% endblock %}
    
    <div class="left_column">
        <br />
        {% widget video.get_video_url %}
    </div>    

    <div class="right_column">
      <br />
      <br />      <br />      <br />      <br />
      {% if is_writelocked %}
          <div class="viewing_old">
              Someone is editing subtitles.
          </div>             
      {% else%}       
          <a href="#" class="new_edit"><span>Submit a new edit based on this version</span></a>
          {% if next_version %}
          <a href="{% block roolback_link %}{% url videos:rollback version.pk %}{% endblock %}" class="roll_back">
              <span>Roll back to version #{{ version.version_no }}</span>
          </a>
          {% endif %}
      {% endif %}
    </div>    
<div class="clearboth">&nbsp;</div>
    <a href="{% block history_link %}{% url videos:history video_id=video.video_id %}{% endblock %}" class="return_history floatright">&lt;&lt; Return to revision history</a>
    
    <ul class="revision_list">
      {% for item in version.captions %}
        <li {% cycle 'class="even"' '' %}>{{ item.display_time }} - {{ item.display_end_time }} &gt; {{ item.text }}</li>
      {% endfor %}
    </ul>
{% endblock %}
