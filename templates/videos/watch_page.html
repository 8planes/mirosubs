{% extends "base.html" %}

{% load i18n %}

{% block body_attrs %}id="watch"{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% url videos:rpc_api %}" type="text/javascript"></script>  
    <script src="{{ MEDIA_URL }}js/jquery.address-1.4.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}js/jquery.ajax-paginator.js" type="text/javascript"></script>
{% endblock %}

{% block main_content %}
<div id="watch_search">
    <span class="icon"></span>
    <input type="text" value="Search videos" />
    <a id="advanced_search" href="">
    <div id="advanced_menu">
        <div class="menu_item videos_in">
            <h3>Videos In</h3>
            <select>
                <option>English (US)</option>
            </select>
        </div><!-- // menu_item -->
        <div class="menu_item">
            <h3>Subtitles into</h3>
            <select>
                <option>English (US)</option>
            </select>
            <button>
                Search
            </button>
        </div><!-- // menu_item -->
    </div><!-- // advanced_menu -->
    </a>
</div><!-- // watch_search -->

<h1>{% trans "Watch Subtitled Videos" %}</h1>

<div class="pod" id="featured_videos">
    <div class="hd">
        <h2>{% trans "Featured Videos" %}</h2>
    </div><!-- // hd -->
    <div class="bd">
        <ul class="video_list clearfix">
            {% for v in featured_videos %}
                {% with v.object as video %}
                    {% include 'videos/_video.html' %}
                {% endwith %}
            {% endfor %}
        </ul><!--// video_list -->
    </div><!-- // bd -->
</div><!-- // pod -->
<br/>

<div class="pod" id="popular_videos">
    <div class="hd clearfix">
        <h2>{% trans "Popular Videos" %}</h2>
        <a id="popular_sort" href="#">
            <span class="current-sort">{% trans "This Week" %}</span>
            <div id="sort_menu">
                <ul>
                    <li val="week" style="display: none">{% trans "This Week" %}</li>
                    <li val="month">{% trans "This Month" %}</li>
                    <li val="year">{% trans "This Year" %}</li>
                    <li val="total">{% trans "All Time" %}</li>
                </ul>
            </div><!-- // sort_menu -->
        </a>
        <script type="text/javascript">
            jQuery(function($){
                var $current_sort = $('#popular_sort .current-sort');
                var $sort_menu = $('#sort_menu');
                var $container = $('.popular-videos-content');
                
                $('li', $sort_menu).click(function(){
                    var $this = $(this);
                    
                    $('li', $sort_menu).show();
                    $this.hide();
                    $current_sort.html($this.html());
                    VideosApi.load_popular_page($this.attr('val'), function(data){
                        $container.html(data.content);
                    });
                    return false;
                });
            });
        </script>                        
    </div><!-- // hd -->
    <div class="bd">
        <div class="popular-videos-content">
            <ul class="video_list clearfix">
                {% for v in popular_videos %}
                    {% with v.object as video %}
                        {% include 'videos/_video.html' %}
                    {% endwith %}
                {% endfor %}
            </ul><!--// video_list -->
        </div>
    </div><!-- // bd -->
</div><!-- // pod -->
<br/>

<div class="pod" id="latest_videos">
    <div class="hd">
        <h2>{% trans "The Latest" %}</h2>
    </div><!-- // hd -->
    <div class="bd">
        <div class="watch-page-content"></div>
        <!-- // pagination start -->
        <div class="pages ajax-pagination clearfix">
            <a class="pag_prev" href=""><span class="icon"></span></a>
            <span class="page_count page-info">
                <span class="from-value">{{ from_value }}</span> - 
                <span class="to-value">{{ to_value }}</span> 
                {% trans "of" %} 
                <span class="total-value">{{ hits }}</span>
                {% blocktrans count hits as hits %}
                    video
                {% plural %}
                    videos
                {% endblocktrans %}                
            </span>
            <span class="page_count loading-indicator" style="display: none;">
                {% trans "Loading..." %}
            </span>            
            <a class="pag_next" href=""><span class="icon"></span></a>
        </div>      
        <!-- // pagination end-->
    </div><!-- // bd -->
</div><!-- // pod -->
<script type="text/javascript">
    jQuery(function($){
        $('.ajax-pagination').ajaxPaginator({
            container: $('.watch-page-content'),
            onPageChange: function(page, callback){
                VideosApi.load_watch_page(page, function(data){
                    var $c = this.options.container;
                    
                    //fix Chrome page jumping
                    $.browser.webkit && $c.css('height', $c.height()+'px');
                    
                    $c.html(data.content || '');
                    
                    //fix Chrome page jumping
                    if ($.browser.webkit) {
                        setTimeout(function(){
                            $c.css('height', $c.children().height()+'px');
                        }, 1);
                    };
                    
                    callback.call(this, data);
                }, this);
            },
        });
    });
</script>

{% endblock %}