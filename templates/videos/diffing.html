{% extends "base.html" %}

{% block css %}
  {{ block.super }}
  <link href="{{ MEDIA_URL }}css/mirosubs-widget.css" media="all" type="text/css" rel="stylesheet" />
  <style>
    div.mirosubs-widget {
        position: relative;    
    }
    .mirosubs-videoDiv {
        text-align: center;
    }
    .mirosubs-videoDiv video, .mirosubs-videoDiv object, .mirosubs-videoDiv embed{
    width: 460px;
    }
    
    #embed{
      white-space: pre;
      background: #eee;
      boder: #666;
    }
  </style>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script type="text/javascript">
        $(function(){
            var IS_AUTHENTICATED = '{{ user.is_authenticated }}' == 'True';
            if (IS_AUTHENTICATED){
                $('.roll_back').click(function(){
                    if ( ! confirm('Do roll back to this version?')){
                        return false;
                    }                    
                });                
            }else{
                $('.roll_back, .new_edit').click(function(){
                    alert('You need to log in to do that.');
                    return false;
                });
            }
        });
    </script>
    {% include "widget/_js_onsite_dependencies.html" %}
{% endblock %}

{% block main_content %}
    <h2>
        Comparing revisions #{{ first_version.version_no }} and #{{ second_version.version_no }}
    </h2>
    {{ video }} in language {{ first_version.language_display }} language<br/><br/>
    
    <a href="{{ history_link }}" class="return_history">
        &lt;&lt; Return to revision history
    </a>
    <div style="clear: both"></div>
    
    <div class="left_column">
        <h3 class="diff_title">
            Revision #{{ first_version.version_no }} - as of {{ first_version.datetime_started|date:"H:i, j F Y" }} 
            by {{ first_version.user.username }}
        </h3>
        
        {% block first_navigation %}
            {% with first_version as version %}
                {% include 'videos/_revision_navigation.html' %}
            {% endwith %}
        {% endblock %}
        
        <div class="clear">&nbsp;</div>
        
        <div id="widget_div_0" class="mirosubs-widget"></div>
        <script type="text/javascript">
          mirosubs.widget.SameDomainEmbed.embed(
              document.getElementById('widget_div_0'), 
              { video_url: '{{video.get_video_url}}' });
        </script>
        
        {% if is_writelocked %}
            <div class="viewing_old">
                Someone is editing subtitles.
            </div>             
        {% else%}
            <a href="#" class="new_edit">Submit a new edit based on this version</a>
            {% if first_version.next_version %}
                <a href="{% block first_roolback_link %}{% url videos:rollback first_version.pk %}{% endblock %}" class="roll_back">
                    Roll back to version #{{ first_version.version_no }}
                </a>
            {% endif %}
        {% endif %}
        
        <ul class="revision_list">
          {% for item in captions %}
            <li {% cycle 'class="even"' '' %}>
                {% if item.0 %}
                    <span {% if item.2.time %}class="time_change"{% endif %}>
                        {{ item.0.display_time }}
                    </span> -
                    <span {% if item.2.end_time %}class="time_change"{% endif %}>
                        {{ item.0.display_end_time }}
                    </span>                    
                     &gt; 
                    <span {% if item.2.text %}class="time_change"{% endif %}>
                        {{ item.0.text }}
                    </span>
                {% else %}
                    &nbsp;
                {% endif %}
            </li>
          {% endfor %}
        </ul>
    </div>
    
    
    <div class="right_column">
        <h3 class="diff_title">
            Revision #{{ second_version.version_no }} - as of {{ second_version.datetime_started|date:"H:i, j F Y" }} 
            by {{ second_version.user.username }}
        </h3>
        
        {% block second_navigation %}
            {% with second_version as version %}
                {% include 'videos/_revision_navigation.html' %}
            {% endwith %}
        {% endblock %}
        
        <div class="clear">&nbsp;</div>
        
        <div id="widget_div_1" class="mirosubs-widget"></div>
        <script type="text/javascript">
          mirosubs.widget.SameDomainEmbed.embed(
              document.getElementById('widget_div_1'), 
              { video_url: '{{video.get_video_url}}' });
        </script>
        
        {% if is_writelocked %}
            <div class="viewing_old">
                Someone is editing subtitles.
            </div>             
        {% else%}        
            <a href="#" class="new_edit">Submit a new edit based on this version</a>
            {% if second_version.next_version %}
                <a href="{% block second_roolback_link %}{% url videos:rollback second_version.pk %}{% endblock %}" class="roll_back">
                    Roll back to version #{{ second_version.version_no }}
                </a>
            {% endif %}
         {% endif %}
        
        <ul class="revision_list">
          {% for item in captions %}
            <li {% cycle 'class="even"' '' %}>
                {% if item.1 %}
                    <span {% if item.2.time %}class="time_change"{% endif %}>
                        {{ item.1.display_time }}
                    </span> -
                    <span {% if item.2.end_time %}class="time_change"{% endif %}>
                        {{ item.1.display_end_time }}
                    </span>                      
                    &gt; 
                    <span {% if item.2.text %}class="time_change"{% endif %}>
                        {{ item.1.text }}
                    </span>
                {% else %}
                    &nbsp;
                {% endif %}
            </li>
          {% endfor %}
        </ul>
    </div>
{% endblock %}
