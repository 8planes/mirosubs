{% extends "base.html" %}

{% load i18n search_tags %}

{% block body_attrs %}id="watch"{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% url videos:rpc_api %}" type="text/javascript"></script>  
    <script src="{{ MEDIA_URL }}js/jquery.address-1.4.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}js/jquery.ajax-paginator.js" type="text/javascript"></script>
{% endblock %}

{% block main_content %}

{% search_form %}

<h1>{% trans "Watch Subtitled Videos" %}</h1>

<div class="pod" id="featured_videos">
    <div class="hd">
        <h2>{% trans "Featured Videos" %}</h2>
    </div><!-- // hd -->
    <div class="bd">
        {% with featured_videos as video_list %}
            {% include 'videos/_watch_page.html' %}
        {% endwith %}
    </div><!-- // bd -->
</div><!-- // pod -->
<br/>

<div class="pod" id="popular_videos">
    <div class="hd clearfix">
        <h2>{% trans "Popular Videos" %}</h2>
        <a id="popular_sort" href="#">
            <span class="current-sort">{% trans "This Week" %}</span>
            <div id="sort_menu">
                <ul>
                    <li val="week" style="display: none">{% trans "This Week" %}</li>
                    <li val="month">{% trans "This Month" %}</li>
                    <li val="year">{% trans "This Year" %}</li>
                    <li val="total">{% trans "All Time" %}</li>
                </ul>
            </div><!-- // sort_menu -->
        </a>
        <script type="text/javascript">
            jQuery(function($){
                var $current_sort = $('#popular_sort .current-sort');
                var $sort_menu = $('#sort_menu');
                var $container = $('.popular-videos-content');
                
                $('li', $sort_menu).click(function(){
                    var $this = $(this);
                    
                    $('li', $sort_menu).show();
                    $this.hide();
                    $current_sort.html($this.html());
                    VideosApi.load_popular_page($this.attr('val'), function(data){
                        $container.html(data.content);
                    });
                    return false;
                });
            });
        </script>                        
    </div><!-- // hd -->
    <div class="bd">
        <div class="popular-videos-content">
            {% with popular_videos as video_list %}
                {% include 'videos/_watch_page.html' %}
            {% endwith %}
        </div>
    </div><!-- // bd -->
</div><!-- // pod -->
<br/>

<div class="pod" id="latest_videos">
    <div class="hd">
        <h2>{% trans "The Latest" %}</h2>
    </div><!-- // hd -->
    <div class="bd">
        <div class="watch-page-content"></div>
        <!-- // pagination start -->
        <div class="pages ajax-pagination clearfix">
            <a class="pag_prev" href=""><span class="icon"></span></a>
            <span class="page_count page-info">
                <span class="from-value">{{ from_value }}</span> - 
                <span class="to-value">{{ to_value }}</span> 
                {% trans "of" %} 
                <span class="total-value">{{ hits }}</span>
                {% blocktrans count hits as hits %}
                    video
                {% plural %}
                    videos
                {% endblocktrans %}                
            </span>
            <span class="page_count loading-indicator" style="display: none;">
                {% trans "Loading..." %}
            </span>            
            <a class="pag_next" href=""><span class="icon"></span></a>
        </div>      
        <!-- // pagination end-->
    </div><!-- // bd -->
</div><!-- // pod -->
<script type="text/javascript">
    jQuery(function($){
        $('.ajax-pagination').ajaxPaginator({
            scrollTo: $('#latest_videos'),
            container: $('.watch-page-content'),
            onPageChange: function(page, callback){
                VideosApi.load_watch_page(page, '{{ request.GET.show_title }}', callback, this);
            },
        });
    });
</script>

{% endblock %}