{% extends "base.html" %}

{% load i18n teams_tags widget %}

{% block body_attrs %}id="teams"{% endblock %}

{% block title %}
    {% trans 'Team video' %} | Universal Subtitles
{% endblock %}

{% block css %}
    {{ block.super }}
    <link href="{{ MEDIA_URL }}css/mirosubs-widget.css" media="all" type="text/css" rel="stylesheet" />
{% endblock %}

{% block scripts %}
    {{ block.super }}
    {% include "widget/_js_onsite_dependencies.html" %}
    <script type="text/javascript">
        jQuery(function($){
            var form_count = {{ formset.total_form_count }};
            var empty_form = $('.empty-form').html();
            var $form_count_field = $('#id_languages-TOTAL_FORMS')
            
            //fix saving value by browser after refresh
            $('.delete-checkbox input').attr('checked', false); 
            $form_count_field.val(form_count);
            
            $('.language_list .remove-language').live('click', function(){
                $(this).parent().hide().find('.delete-checkbox input').attr('checked', true);
                return false;
            })
            
            $('.add-language').click(function(){
                form_count++;
                $form_count_field.val(form_count);
                var form = empty_form.replace(/__prefix__/g, (form_count-1));
                $('.language_list li:last').after(form);
                return false;
            });
        });
    </script>
{% endblock %}

{% block main_content %}

{% team_select team %}

<h2>{% trans 'Manage Settings & Teams' %}</h2>
<div class="grid_3 left_nav_wrapper alpha">
    <ul class="left_nav">
        <li class="active">
            <a href="#">{% trans 'Your Teams' %}</a>
        </li>
    </ul>
</div>
<div class="wrap grid_9 omega">
    <h4 class="inline">{{ team }}</h4>
    <ul class="inline_tabs">
        <li class="active">
            <span class="tab-item">{% trans 'Team Settings' %}</span>
        </li>
        <li class="bull">&bull;</li>        
        <li>
            <a href="{% url teams:edit_members team.slug %}">{% trans 'Team Members' %}<span class="badgy_out"><span class="badgy">{{ team.member_count }}</span></span></a>
        </li>
        <li class="bull">&bull;</li>        
        <li>
            <a href="{% url teams:edit_videos team.slug %}">{% trans 'Team Videos' %}<span class="badgy_out"><span class="badgy">{{ team.videos_count }}</span></span></a>
        </li>
        <li class="bull">&bull;</li>        
        <li>
            <a href="{% url teams:applications team.slug %}">{% trans 'Review Applicants' %}<span class="badgy_out"><span class="badgy">{{ team.applications_count }}</span></span></a>
        </li>
    </ul>
    <div class="boxx">
        <div class="padding">
            {% widget widget_params %}
            <form method='post' action="." enctype="multipart/form-data">
            {{ form.as_p }}
            {% csrf_token %}
            <h3>{% trans 'Languages needed' %}</h3>
            <ul class="language_list">
                {{ formset.management_form }}
                {{ formset.non_field_errors }}
                {% for form in formset.forms %}
                    <li class="user_language">
                        {{ form.non_field_errors }}
                        <a href="#" class="small_close remove-language">{% trans 'Remove Language' %}</a>
                        {{ form.id }}
                        {{ form.language.errors }}
                        {{ form.language }}
                        {{ form.completed.errors }}
                        {{ form.completed }}
                        {{ form.completed.label }}
                        <div style="display: none" class="delete-checkbox">
                            {{ form.DELETE }}
                        </div>
                    </li>
                {% endfor %}
            </ul>
            <button class="green_button small add-language">
                <span><span class="plus"></span>{% trans 'Add Language' %}</span>
            </button>
            
            <div class="empty-form" style="display: none">
                <li class="user_language">
                    <a href="#" class="small_close remove-language">{% trans 'Remove Language' %}</a>
                    {{ formset.empty_form.id }}
                    {{ formset.empty_form.language }}
                    {{ formset.empty_form.completed }}
                    {{ formset.empty_form.completed.label }}
                    <div style="display: none" class="delete-checkbox">
                        {{ form.DELETE }}
                    </div>                
                </li>
            </div>                
            <p>
                <br/>
                <button class="green_button small"><span>{% trans 'Save' %}</span></button>
            </p>
            </form>
            <div class="clearfix"></div>        
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="clearfix"></div>
</div>
{% endblock %}