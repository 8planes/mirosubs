{% load i18n teams_tags %}
<script type="text/javascript">
    jQuery(function($){
        $('a.join-team').click(function(){
            if (confirm('{% trans "Do you really wish join this team?" %}')){
                var $this = $(this);
                TeamsApi.join($this.attr('team_id'), function(response){
                    if (response.error){
                        $.msg.clean().add(response.error, 'error');
                    }else{
                        $.msg.clean().add(response.msg);
                        $this.remove();
                    }
                });
            };
            return false;
        });
        $('a.leave-team').click(function(){
            if (confirm('{% trans "Do you really wish leave this team?" %}')){
                var $this = $(this);
                TeamsApi.leave($this.attr('team_id'), function(response){
                    if (response.error){
                        $.msg.clean().add(response.error, 'error');
                    }else{
                        $.msg.clean().add(response.msg);
                        $this.parents('.team-detail').find('.your-team').remove();
                        $this.remove();
                    }
                });
            }
            return false;
        });
        $apptxt = $('div.application-textarea')  
        $('a.join-team-by-application').click(function(){
            $apptxt.show();
            $(this).remove();
            return false;
        });
        $('button', $apptxt).click(function(){
            var $t = $('textarea', $apptxt);
            TeamsApi.create_application($(this).attr('team_id'), $t.val(), function(response){
                if (response.error){
                    $.msg.clean().add(response.error, 'error');
                }else{
                    $.msg.clean().add(response.msg);
                    $apptxt.remove();
                }                
            });
            return false;
        });          
    });
</script>   
    
<div class="team-detail">
    {% if not team.video %}
    <div class="team_logo">
        {% if team.logo %}
        <img alt="{{ team }}" title="{{ team }}" src="{{ team.logo_thumbnail }}"/>
        {% endif %}
    </div>
    {% endif %}
    {% if team.description %}
    <p>
        <b>{% trans 'Team Description' %}:</b> {{ team.description|urlize }}
    </p>
    {% endif %}
    <p>
        <b>{% trans 'Team Managers' %}:</b>
        {% for item in team.members.managers %}
            <a href="{{ item.user.get_absolute_url }}">{{ item.user }}</a>{% if not forloop.last %},{% endif %}
        {% endfor %}
    </p>
    <p>
        <b>{% trans 'Video Policy' %}:</b>
        {{ team.get_video_policy_display }}
    </p>
    <p>
        <b>{% trans 'Membership Policy' %}:</b>
        {{ team.get_membership_policy_display }}
    </p>        
    {% if team|is_team_member:user %}
        <p>
            <a href="{{ team.get_edit_url }}" class="your-team">{% trans "Manager's Settings & Controls" %}</a><br/>
            <a class="leave-team" team_id="{{ team.pk }}" href="#">{% trans "Leave" %}</a>   
        </p>
    {% else %}
        {% if user.is_authenticated %}
            {% if team.is_open %}
            <p>
               <a class="join-team" team_id="{{ team.pk }}" href="#">{% trans "Join" %}</a> 
            </p>
            {% endif %}
            {% if team.is_by_application %}
            <p>
                <a class="join-team-by-application" team_id="{{ team.pk }}" href="#">{% trans "Send application" %}</a>
                <div style="display: none" class="application-textarea">
                    <textarea></textarea>
                    <button team_id="{{ team.pk }}">{% trans "Send" %}</button>
                </div>
            </p>
            {% endif %}
        {% endif %}
    {% endif %} 
</div>